export default defineNuxtPlugin((nuxtApp) => {
    console.log(`\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🟢 [C1] CLIENT PLUGIN — Инициализация клиентского плагина и хук app:created
   💡 Инициализация только-клиентских вещей: аналитика, подписка на хуки
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n`)

    nuxtApp.hook('app:beforeMount', () => {
        console.log(`\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🟢 [C5] Nuxt Hook app:beforeMount — Перед началом гидрации Vue
   💡 Финальная подготовка перед гидрацией: профайлеры, глобальные слушатели
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n`)
    })

    nuxtApp.hook('app:mounted', () => {
        console.log(`\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🟢 [C9] Nuxt Hook app:mounted — После завершения гидрации приложения
   💡 Запуск подсистем, которым нужен реальный DOM/окно (карты, порталы)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n`)
    })

    // В Nuxt 4 используем useRouter() для отслеживания навигации
    const router = useRouter()
    
    router.beforeEach((to) => {
        console.log(`\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🟢 [C3] Nuxt Hook page:start — Начало клиентской навигации/инициализации
   📍 Переход на: ${to.fullPath}
   💡 Управление UX: показать лоадер, старт таймеров/метрик
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n`)
    })

    router.afterEach((to, from) => {
        const fromPath = from?.fullPath ?? '(initial)'
        console.log(`\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🟢 [C4] Nuxt Hook page:finish — Конец инициализации страницы
   📍 Навигация завершена: ${fromPath} → ${to.fullPath}
   💡 Закрыть лоадер, зафиксировать метрики, обновить аналитику
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n`)
    })
})
